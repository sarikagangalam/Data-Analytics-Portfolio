//create a database //
create database AmazoneDB;
Use  AmazoneDB;

Create table ProductsReviews (
product_id Int,
product_name varchar(255),
category varchar(255),
discounted_price decimal(10,2),
actual_price decimal(10,2),
discount_percentage decimal (5,2),
rating decimal (3,2),
rating_count int,
about_product TEXT,
user_id Int,
user_name varchar(255),
review_id INT,
review_title varchar(255),
review_content longtext,
img_link TEXT,
product_link TEXT
);

select * from ProductsReviews;


//Loading data from excel to the sql table //


LOAD DATA INFILE
'C:\ProgramData\MySQL\MySQL Server 8.0\Uploads\amazone Dataset-cleaning.csv'
INTO TABLE ProductsReviews
CHARACTER SET utf8mb4
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 ROWS;





//cleaning the data into a useful way //

use amazonedb;

DROP TABLE IF EXISTS products_reviews_clean;


CREATE TABLE products_reviews_clean (
  product_id VARCHAR(50),
  product_name TEXT,
  category TEXT,

  actual_price DECIMAL(10,2),
  discounted_price DECIMAL(10,2),
  discount_percentage DECIMAL(5,2),

  rating DECIMAL(3,2),
  rating_count INT,

  about_product TEXT,
  user_id VARCHAR(255),
  user_name TEXT,
  review_id TEXT,
  review_title TEXT,
  review_content TEXT,
  img_link TEXT,
  product_link TEXT
);

INSERT INTO products_reviews_clean
SELECT
  product_id,
  product_name,
  category,

  CASE
    WHEN actual_price REGEXP '^[₹0-9,]+$'
    THEN CAST(REPLACE(REPLACE(actual_price,'₹',''),',','') AS DECIMAL(10,2))
    ELSE NULL
  END AS actual_price,

  CASE
    WHEN discounted_price REGEXP '^[₹0-9,]+$'
    THEN CAST(REPLACE(REPLACE(discounted_price,'₹',''),',','') AS DECIMAL(10,2))
    ELSE NULL
  END AS discounted_price,

  CASE
    WHEN discount_percentage REGEXP '^[0-9]+%$'
    THEN CAST(REPLACE(discount_percentage,'%','') AS DECIMAL(5,2))
    ELSE NULL
  END AS discount_percentage,

  CASE
    WHEN rating REGEXP '^[0-9.]+$'
    THEN CAST(rating AS DECIMAL(3,2))
    ELSE NULL
  END AS rating,

  CASE
    WHEN rating_count REGEXP '^[0-9,]+$'
    THEN CAST(REPLACE(rating_count,',','') AS UNSIGNED)
    ELSE NULL
  END AS rating_count,

  about_product,
  user_id,
  user_name,
  review_id,
  review_title,
  review_content,
  img_link,
  product_link

FROM products_reviews_raw;


select * from products_reviews_clean;
